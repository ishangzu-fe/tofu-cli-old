#! /usr/bin/env node

const program = require('commander');
const exec = require('child_process').exec;
const config = require('../config');

program
    .option('--cnpm', '使用cnpm来代替npm')
    .option('--yarn', '使用yarn来代替npm')
    .option('--npm', '使用npm来代替设置的工具')
    .parse(process.argv);

// require('../lib/check-version')();

let child;
if (program.cnpm) {
    child = exec('cnpm install itofu@latest&cnpm install -g tofu-cli@latest');
} else if (program.yarn) {
    child = exec('yarn add itofu@latest&yarn global add tofu-cli@latest');
} else if (program.npm) {
    child = exec('npm install itofu@latest&npm install -g tofu-cli@latest');
} else {
    child = exec(config.tool + ' install itofu@latest&' + config.tool + ' install -g tofu-cli@latest', (error, stdout, stderr) => {
        if (error) {
            console.error(`exec error: ${error}`);
            return;
        }
        console.log(`stdout: ${stdout}`);
        console.log(`stderr: ${stderr}`);
    });
}

child.on('error', (err) => {
    throw error;
});

child.on('close', (code, signal) => {
    if (code === 0) {
        console.log('成功更新了tofu和tofu-cli');
    }
});
